var it=(e,t,r)=>{if(!t.has(e))throw TypeError("Cannot "+r)};var P=(e,t,r)=>(it(e,t,"read from private field"),r?r.call(e):t.get(e)),he=(e,t,r)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,r)},Se=(e,t,r,s)=>(it(e,t,"write to private field"),s?s.call(e,r):t.set(e,r),r);var Ae=(e,t,r)=>(it(e,t,"access private method"),r);import{S as tr,q as rr,v as Vt,x as nr,y as sr,z,A as Ge,B as ir,w as re,C as or,D as kt,E as ar,G as lr,H as ur,p as He,e as Y,u as te,I as Z,J as cr,K as Ot,L as j,f as Mt,M as dr,N as fr,O as vr,P as pr,Q as mr,d as dt,c as x,a as y,n as ft,t as Me,R as hr,o as ee,_ as vt,T as ut,U as Rt,V as gr,W as yr,X as Be,Y as _t,Z as br,m as Vr,g as Te,$ as we,F as De,r as ot,a0 as Or,l as St,a1 as _r,a2 as Sr}from"./index-Cq-1Whkx.js";import{u as Ar,g as wr,a as Er}from"./get-product-image.action-B_L1PO_j.js";var ae,le,q,se,Ie,Ke,Ue,ct,Tt,Ir=(Tt=class extends tr{constructor(t,r){super();he(this,Ie);he(this,Ue);he(this,ae,void 0);he(this,le,void 0);he(this,q,void 0);he(this,se,void 0);Se(this,ae,t),this.setOptions(r),this.bindMethods(),Ae(this,Ie,Ke).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){var s;const r=this.options;this.options=P(this,ae).defaultMutationOptions(t),rr(this.options,r)||P(this,ae).getMutationCache().notify({type:"observerOptionsUpdated",mutation:P(this,q),observer:this}),r!=null&&r.mutationKey&&this.options.mutationKey&&Vt(r.mutationKey)!==Vt(this.options.mutationKey)?this.reset():((s=P(this,q))==null?void 0:s.state.status)==="pending"&&P(this,q).setOptions(this.options)}onUnsubscribe(){var t;this.hasListeners()||(t=P(this,q))==null||t.removeObserver(this)}onMutationUpdate(t){Ae(this,Ie,Ke).call(this),Ae(this,Ue,ct).call(this,t)}getCurrentResult(){return P(this,le)}reset(){var t;(t=P(this,q))==null||t.removeObserver(this),Se(this,q,void 0),Ae(this,Ie,Ke).call(this),Ae(this,Ue,ct).call(this)}mutate(t,r){var s;return Se(this,se,r),(s=P(this,q))==null||s.removeObserver(this),Se(this,q,P(this,ae).getMutationCache().build(P(this,ae),this.options)),P(this,q).addObserver(this),P(this,q).execute(t)}},ae=new WeakMap,le=new WeakMap,q=new WeakMap,se=new WeakMap,Ie=new WeakSet,Ke=function(){var r;const t=((r=P(this,q))==null?void 0:r.state)??nr();Se(this,le,{...t,isPending:t.status==="pending",isSuccess:t.status==="success",isError:t.status==="error",isIdle:t.status==="idle",mutate:this.mutate,reset:this.reset})},Ue=new WeakSet,ct=function(t){sr.batch(()=>{var r,s,o,a,f,g,u,d;if(P(this,se)&&this.hasListeners()){const b=P(this,le).variables,S=P(this,le).context;(t==null?void 0:t.type)==="success"?((s=(r=P(this,se)).onSuccess)==null||s.call(r,t.data,b,S),(a=(o=P(this,se)).onSettled)==null||a.call(o,t.data,null,b,S)):(t==null?void 0:t.type)==="error"&&((g=(f=P(this,se)).onError)==null||g.call(f,t.error,b,S),(d=(u=P(this,se)).onSettled)==null||d.call(u,void 0,t.error,b,S))}this.listeners.forEach(b=>{b(P(this,le))})})},Tt);function jr(e,t){const r=t||Ar(),s=z(()=>r.defaultMutationOptions(ar(e))),o=new Ir(r,s.value),a=Ge(o.getCurrentResult()),f=o.subscribe(d=>{ir(a,d)}),g=(d,b)=>{o.mutate(d,b).catch(()=>{})};re(s,()=>{o.setOptions(s.value)}),lr(()=>{f()});const u=or(kt(a));return re(()=>a.error,d=>{if(d&&ur(s.value.throwOnError,[d]))throw d}),{...u,mutate:g,mutateAsync:a.mutate,reset:a.reset}}const Cr=async e=>{if(e==="create")return{id:"",title:"",slug:"",description:"",price:0,stock:0,images:[],tags:[],sizes:[],gender:"",user:{}};try{const{data:t}=await He.get(`/products/${e}`);return console.log({data:t}),{...t,images:t.images.map(wr)}}catch(t){throw console.log(t),new Error(`Error getting product by id ${e}`)}},Pr=async e=>{const t=e.id,r=await kr(e.images??[]);return e.images=r,e=Fr(e),t&&t!==""?await Nr(t,e):await Tr(e)},Fr=e=>{var r;const t=((r=e.images)==null?void 0:r.map(s=>s.startsWith("http")?s.split("/").pop()?s:"":s))??[];return delete e.id,delete e.user,e.images=t,e},Nr=async(e,t)=>{try{const{data:r}=await He.patch(`/products/${e}`,t);return r}catch(r){throw console.log(r),new Error("Error updating product")}},Tr=async e=>{try{const{data:t}=await He.post("/products",e);return t}catch(t){throw console.log(t),new Error("Error creating product")}},kr=async e=>{const t=e.filter(a=>a instanceof File),r=e.filter(a=>typeof a=="string"),s=t.map(async a=>{try{const f=new FormData;f.append("file",a);const{data:g}=await He.post("/files/product",f);return g.secureUrl}catch(f){throw console.log(f),new Error("Error uploading image")}}),o=await Promise.all(s);return[...r,...o]};/**
  * vee-validate v4.12.6
  * (c) 2024 Abdelrahman Awad
  * @license MIT
  */function Q(e){return typeof e=="function"}function Ee(e){return e==null}const je=e=>e!==null&&!!e&&typeof e=="object"&&!Array.isArray(e);function pt(e){return Number(e)>=0}function Mr(e){return typeof e=="object"&&e!==null}function Rr(e){return e==null?e===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(e)}function At(e){if(!Mr(e)||Rr(e)!=="[object Object]")return!1;if(Object.getPrototypeOf(e)===null)return!0;let t=e;for(;Object.getPrototypeOf(t)!==null;)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function Re(e,t){return Object.keys(t).forEach(r=>{if(At(t[r])&&At(e[r])){e[r]||(e[r]={}),Re(e[r],t[r]);return}e[r]=t[r]}),e}function Le(e){const t=e.split(".");if(!t.length)return"";let r=String(t[0]);for(let s=1;s<t.length;s++){if(pt(t[s])){r+=`[${t[s]}]`;continue}r+=`.${t[s]}`}return r}const Ur={};function $r(e){return Ur[e]}function wt(e,t,r){typeof r.value=="object"&&(r.value=E(r.value)),!r.enumerable||r.get||r.set||!r.configurable||!r.writable||t==="__proto__"?Object.defineProperty(e,t,r):e[t]=r.value}function E(e){if(typeof e!="object")return e;var t=0,r,s,o,a=Object.prototype.toString.call(e);if(a==="[object Object]"?o=Object.create(e.__proto__||null):a==="[object Array]"?o=Array(e.length):a==="[object Set]"?(o=new Set,e.forEach(function(f){o.add(E(f))})):a==="[object Map]"?(o=new Map,e.forEach(function(f,g){o.set(E(g),E(f))})):a==="[object Date]"?o=new Date(+e):a==="[object RegExp]"?o=new RegExp(e.source,e.flags):a==="[object DataView]"?o=new e.constructor(E(e.buffer)):a==="[object ArrayBuffer]"?o=e.slice(0):a.slice(-6)==="Array]"&&(o=new e.constructor(e)),o){for(s=Object.getOwnPropertySymbols(e);t<s.length;t++)wt(o,s[t],Object.getOwnPropertyDescriptor(e,s[t]));for(t=0,s=Object.getOwnPropertyNames(e);t<s.length;t++)Object.hasOwnProperty.call(o,r=s[t])&&o[r]===e[r]||wt(o,r,Object.getOwnPropertyDescriptor(e,r))}return o||e}const Ut=Symbol("vee-validate-form"),zr=typeof window<"u";function Br(e){return Q(e)&&!!e.__locatorRef}function ue(e){return!!e&&Q(e.parse)&&e.__type==="VVTypedSchema"}function $t(e){return!!e&&Q(e.validate)}function Dr(e){return e==="checkbox"||e==="radio"}function Lr(e){return je(e)||Array.isArray(e)}function qr(e){return Array.isArray(e)?e.length===0:je(e)&&Object.keys(e).length===0}function Xe(e){return/^\[.+\]$/i.test(e)}function Wr(e){return zt(e)&&e.multiple}function zt(e){return e.tagName==="SELECT"}function Kr(e){return Bt(e)&&e.target&&"submit"in e.target}function Bt(e){return e?!!(typeof Event<"u"&&Q(Event)&&e instanceof Event||e&&e.srcElement):!1}function ce(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){if(e.constructor!==t.constructor)return!1;var r,s,o;if(Array.isArray(e)){if(r=e.length,r!=t.length)return!1;for(s=r;s--!==0;)if(!ce(e[s],t[s]))return!1;return!0}if(e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(s of e.entries())if(!t.has(s[0]))return!1;for(s of e.entries())if(!ce(s[1],t.get(s[0])))return!1;return!0}if(Et(e)&&Et(t))return!(e.size!==t.size||e.name!==t.name||e.lastModified!==t.lastModified||e.type!==t.type);if(e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(s of e.entries())if(!t.has(s[0]))return!1;return!0}if(ArrayBuffer.isView(e)&&ArrayBuffer.isView(t)){if(r=e.length,r!=t.length)return!1;for(s=r;s--!==0;)if(e[s]!==t[s])return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===t.toString();for(o=Object.keys(e),r=o.length,s=r;s--!==0;){var a=o[s];if(!ce(e[a],t[a]))return!1}return!0}return e!==e&&t!==t}function Et(e){return zr?e instanceof File:!1}function mt(e){return Xe(e)?e.replace(/\[|\]/gi,""):e}function M(e,t,r){return e?Xe(t)?e[mt(t)]:(t||"").split(/\.|\[(\d+)\]/).filter(Boolean).reduce((o,a)=>Lr(o)&&a in o?o[a]:r,e):r}function B(e,t,r){if(Xe(t)){e[mt(t)]=r;return}const s=t.split(/\.|\[(\d+)\]/).filter(Boolean);let o=e;for(let a=0;a<s.length;a++){if(a===s.length-1){o[s[a]]=r;return}(!(s[a]in o)||Ee(o[s[a]]))&&(o[s[a]]=pt(s[a+1])?[]:{}),o=o[s[a]]}}function at(e,t){if(Array.isArray(e)&&pt(t)){e.splice(Number(t),1);return}je(e)&&delete e[t]}function It(e,t){if(Xe(t)){delete e[mt(t)];return}const r=t.split(/\.|\[(\d+)\]/).filter(Boolean);let s=e;for(let a=0;a<r.length;a++){if(a===r.length-1){at(s,r[a]);break}if(!(r[a]in s)||Ee(s[r[a]]))break;s=s[r[a]]}const o=r.map((a,f)=>M(e,r.slice(0,f).join(".")));for(let a=o.length-1;a>=0;a--)if(qr(o[a])){if(a===0){at(e,r[0]);continue}at(o[a-1],r[a-1])}}function G(e){return Object.keys(e)}function Gr(e,t=void 0){const r=mr();return(r==null?void 0:r.provides[e])||fr(e,t)}function jt(e,t=0){let r=null,s=[];return function(...o){return r&&clearTimeout(r),r=setTimeout(()=>{const a=e(...o);s.forEach(f=>f(a)),s=[]},t),new Promise(a=>s.push(a))}}function Hr(e,t){let r;return async function(...o){const a=e(...o);r=a;const f=await a;return a!==r?f:(r=void 0,t(f,o))}}function Xr({get:e,set:t}){const r=Y(E(e()));return re(e,s=>{ce(s,r.value)||(r.value=E(s))},{deep:!0}),re(r,s=>{ce(s,e())||t(E(s))},{deep:!0}),r}function Ct(e){return Array.isArray(e)?e:e?[e]:[]}function qe(e,t){const r={};for(const s in e)t.includes(s)||(r[s]=e[s]);return r}function Yr(e){let t=null,r=[];return function(...s){const o=Z(()=>{if(t!==o)return;const a=e(...s);r.forEach(f=>f(a)),r=[],t=null});return t=o,new Promise(a=>r.push(a))}}function lt(e){if(Dt(e))return e._value}function Dt(e){return"_value"in e}function Qr(e){return e.type==="number"||e.type==="range"?Number.isNaN(e.valueAsNumber)?e.value:e.valueAsNumber:e.value}function Pt(e){if(!Bt(e))return e;const t=e.target;if(Dr(t.type)&&Dt(t))return lt(t);if(t.type==="file"&&t.files){const r=Array.from(t.files);return t.multiple?r:r[0]}if(Wr(t))return Array.from(t.options).filter(r=>r.selected&&!r.disabled).map(lt);if(zt(t)){const r=Array.from(t.options).find(s=>s.selected);return r?lt(r):t.value}return Qr(t)}function Jr(e){const t={};return Object.defineProperty(t,"_$$isNormalized",{value:!0,writable:!1,enumerable:!1,configurable:!1}),e?je(e)&&e._$$isNormalized?e:je(e)?Object.keys(e).reduce((r,s)=>{const o=Zr(e[s]);return e[s]!==!1&&(r[s]=Ft(o)),r},t):typeof e!="string"?t:e.split("|").reduce((r,s)=>{const o=xr(s);return o.name&&(r[o.name]=Ft(o.params)),r},t):t}function Zr(e){return e===!0?[]:Array.isArray(e)||je(e)?e:[e]}function Ft(e){const t=r=>typeof r=="string"&&r[0]==="@"?en(r.slice(1)):r;return Array.isArray(e)?e.map(t):e instanceof RegExp?[e]:Object.keys(e).reduce((r,s)=>(r[s]=t(e[s]),r),{})}const xr=e=>{let t=[];const r=e.split(":")[0];return e.includes(":")&&(t=e.split(":").slice(1).join(":").split(",")),{name:r,params:t}};function en(e){const t=r=>M(r,e)||r[e];return t.__locatorRef=e,t}const tn={generateMessage:({field:e})=>`${e} is not valid.`,bails:!0,validateOnBlur:!0,validateOnChange:!0,validateOnInput:!1,validateOnModelUpdate:!0};let rn=Object.assign({},tn);const ke=()=>rn;async function nn(e,t,r={}){const s=r==null?void 0:r.bails,o={name:(r==null?void 0:r.name)||"{field}",rules:t,label:r==null?void 0:r.label,bails:s??!0,formData:(r==null?void 0:r.values)||{}},f=(await sn(o,e)).errors;return{errors:f,valid:!f.length}}async function sn(e,t){if(ue(e.rules)||$t(e.rules))return an(t,e.rules);if(Q(e.rules)||Array.isArray(e.rules)){const f={field:e.label||e.name,name:e.name,label:e.label,form:e.formData,value:t},g=Array.isArray(e.rules)?e.rules:[e.rules],u=g.length,d=[];for(let b=0;b<u;b++){const S=g[b],I=await S(t,f);if(!(typeof I!="string"&&!Array.isArray(I)&&I)){if(Array.isArray(I))d.push(...I);else{const K=typeof I=="string"?I:qt(f);d.push(K)}if(e.bails)return{errors:d}}}return{errors:d}}const r=Object.assign(Object.assign({},e),{rules:Jr(e.rules)}),s=[],o=Object.keys(r.rules),a=o.length;for(let f=0;f<a;f++){const g=o[f],u=await ln(r,t,{name:g,params:r.rules[g]});if(u.error&&(s.push(u.error),e.bails))return{errors:s}}return{errors:s}}function on(e){return!!e&&e.name==="ValidationError"}function Lt(e){return{__type:"VVTypedSchema",async parse(r){var s;try{return{output:await e.validate(r,{abortEarly:!1}),errors:[]}}catch(o){if(!on(o))throw o;if(!(!((s=o.inner)===null||s===void 0)&&s.length)&&o.errors.length)return{errors:[{path:o.path,errors:o.errors}]};const a=o.inner.reduce((f,g)=>{const u=g.path||"";return f[u]||(f[u]={errors:[],path:u}),f[u].errors.push(...g.errors),f},{});return{errors:Object.values(a)}}}}}async function an(e,t){const s=await(ue(t)?t:Lt(t)).parse(e),o=[];for(const a of s.errors)a.errors.length&&o.push(...a.errors);return{errors:o}}async function ln(e,t,r){const s=$r(r.name);if(!s)throw new Error(`No such validator '${r.name}' exists.`);const o=un(r.params,e.formData),a={field:e.label||e.name,name:e.name,label:e.label,value:t,form:e.formData,rule:Object.assign(Object.assign({},r),{params:o})},f=await s(t,o,a);return typeof f=="string"?{error:f}:{error:f?void 0:qt(a)}}function qt(e){const t=ke().generateMessage;return t?t(e):"Field is invalid"}function un(e,t){const r=s=>Br(s)?s(t):s;return Array.isArray(e)?e.map(r):Object.keys(e).reduce((s,o)=>(s[o]=r(e[o]),s),{})}async function cn(e,t){const s=await(ue(e)?e:Lt(e)).parse(E(t)),o={},a={};for(const f of s.errors){const g=f.errors,u=(f.path||"").replace(/\["(\d+)"\]/g,(d,b)=>`[${b}]`);o[u]={valid:!g.length,errors:g},g.length&&(a[u]=g[0])}return{valid:!s.errors.length,results:o,errors:a,values:s.value}}async function dn(e,t,r){const o=G(e).map(async d=>{var b,S,I;const F=(b=r==null?void 0:r.names)===null||b===void 0?void 0:b[d],K=await nn(M(t,d),e[d],{name:(F==null?void 0:F.name)||d,label:F==null?void 0:F.label,values:t,bails:(I=(S=r==null?void 0:r.bailsMap)===null||S===void 0?void 0:S[d])!==null&&I!==void 0?I:!0});return Object.assign(Object.assign({},K),{path:d})});let a=!0;const f=await Promise.all(o),g={},u={};for(const d of f)g[d.path]={valid:d.valid,errors:d.errors},d.valid||(a=!1,u[d.path]=d.errors[0]);return{valid:a,results:g,errors:u}}let fn=0;const We=["bails","fieldsCount","id","multiple","type","validate"];function Wt(e){const t=Object.assign({},j((e==null?void 0:e.initialValues)||{})),r=te(e==null?void 0:e.validationSchema);return r&&ue(r)&&Q(r.cast)?E(r.cast(t)||{}):E(t)}function vn(e){var t;const r=fn++;let s=0;const o=Y(!1),a=Y(!1),f=Y(0),g=[],u=Ge(Wt(e)),d=Y([]),b=Y({}),S=Y({}),I=Yr(()=>{S.value=d.value.reduce((i,n)=>(i[Le(j(n.path))]=n,i),{})});function F(i,n){const l=U(i);if(!l){typeof i=="string"&&(b.value[Le(i)]=Ct(n));return}if(typeof i=="string"){const c=Le(i);b.value[c]&&delete b.value[c]}l.errors=Ct(n),l.valid=!l.errors.length}function K(i){G(i).forEach(n=>{F(n,i[n])})}e!=null&&e.initialErrors&&K(e.initialErrors);const ie=z(()=>{const i=d.value.reduce((n,l)=>(l.errors.length&&(n[l.path]=l.errors),n),{});return Object.assign(Object.assign({},b.value),i)}),de=z(()=>G(ie.value).reduce((i,n)=>{const l=ie.value[n];return l!=null&&l.length&&(i[n]=l[0]),i},{})),ge=z(()=>d.value.reduce((i,n)=>(i[n.path]={name:n.path||"",label:n.label||""},i),{})),Ce=z(()=>d.value.reduce((i,n)=>{var l;return i[n.path]=(l=n.bails)!==null&&l!==void 0?l:!0,i},{})),ye=Object.assign({},(e==null?void 0:e.initialErrors)||{}),be=(t=e==null?void 0:e.keepValuesOnUnmount)!==null&&t!==void 0?t:!1,{initialValues:p,originalInitialValues:m,setInitialValues:V}=mn(d,u,e),_=pn(d,u,m,de),w=z(()=>d.value.reduce((i,n)=>{const l=M(u,n.path);return B(i,n.path,l),i},{})),O=e==null?void 0:e.validationSchema;function k(i,n){var l,c;const h=z(()=>M(p.value,j(i))),v=S.value[j(i)],A=(n==null?void 0:n.type)==="checkbox"||(n==null?void 0:n.type)==="radio";if(v&&A){v.multiple=!0;const X=s++;return Array.isArray(v.id)?v.id.push(X):v.id=[v.id,X],v.fieldsCount++,v.__flags.pendingUnmount[X]=!1,v}const N=z(()=>M(u,j(i))),T=j(i),D=ve.findIndex(X=>X===T);D!==-1&&ve.splice(D,1);const C=z(()=>{var X,Ne,rt,bt,nt,st;return ue(O)?(rt=(Ne=(X=O).describe)===null||Ne===void 0?void 0:Ne.call(X,j(i)).required)!==null&&rt!==void 0?rt:!1:ue(n==null?void 0:n.schema)&&(st=(nt=(bt=n==null?void 0:n.schema).describe)===null||nt===void 0?void 0:nt.call(bt).required)!==null&&st!==void 0?st:!1}),$=s++,L=Ge({id:$,path:i,touched:!1,pending:!1,valid:!0,validated:!!(!((l=ye[T])===null||l===void 0)&&l.length),required:C,initialValue:h,errors:vr([]),bails:(c=n==null?void 0:n.bails)!==null&&c!==void 0?c:!1,label:n==null?void 0:n.label,type:(n==null?void 0:n.type)||"default",value:N,multiple:!1,__flags:{pendingUnmount:{[$]:!1},pendingReset:!1},fieldsCount:1,validate:n==null?void 0:n.validate,dirty:z(()=>!ce(te(N),te(h)))});return d.value.push(L),S.value[T]=L,I(),de.value[T]&&!ye[T]&&Z(()=>{me(T,{mode:"silent"})}),Ot(i)&&re(i,X=>{I();const Ne=E(N.value);S.value[X]=L,Z(()=>{B(u,X,Ne)})}),L}const H=jt(yt,5),Pe=jt(yt,5),$e=Hr(async i=>await(i==="silent"?H():Pe()),(i,[n])=>{const l=G(ne.errorBag.value),h=[...new Set([...G(i.results),...d.value.map(v=>v.path),...l])].sort().reduce((v,A)=>{var N;const T=A,D=U(T)||Ve(T),C=((N=i.results[T])===null||N===void 0?void 0:N.errors)||[],$=j(D==null?void 0:D.path)||T,L=hn({errors:C,valid:!C.length},v.results[$]);return v.results[$]=L,L.valid||(v.errors[$]=L.errors[0]),D&&b.value[$]&&delete b.value[$],D?(D.valid=L.valid,n==="silent"||n==="validated-only"&&!D.validated||F(D,L.errors),v):(F($,C),v)},{valid:i.valid,results:{},errors:{}});return i.values&&(h.values=i.values),G(h.results).forEach(v=>{var A;const N=U(v);N&&n!=="silent"&&(n==="validated-only"&&!N.validated||F(N,(A=h.results[v])===null||A===void 0?void 0:A.errors))}),h});function fe(i){d.value.forEach(i)}function U(i){const n=typeof i=="string"?Le(i):i;return typeof n=="string"?S.value[n]:n}function Ve(i){return d.value.filter(l=>i.startsWith(l.path)).reduce((l,c)=>l?c.path.length>l.path.length?c:l:c,void 0)}let ve=[],Oe;function Ye(i){return ve.push(i),Oe||(Oe=Z(()=>{[...ve].sort().reverse().forEach(l=>{It(u,l)}),ve=[],Oe=null})),Oe}function R(i){return function(l,c){return function(v){return v instanceof Event&&(v.preventDefault(),v.stopPropagation()),fe(A=>A.touched=!0),o.value=!0,f.value++,_e().then(A=>{const N=E(u);if(A.valid&&typeof l=="function"){const T=E(w.value);let D=i?T:N;return A.values&&(D=A.values),l(D,{evt:v,controlledValues:T,setErrors:K,setFieldError:F,setTouched:Ze,setFieldTouched:ze,setValues:Qe,setFieldValue:oe,resetForm:xe,resetField:ht})}!A.valid&&typeof c=="function"&&c({values:N,evt:v,errors:A.errors,results:A.results})}).then(A=>(o.value=!1,A),A=>{throw o.value=!1,A})}}}const J=R(!1);J.withControlled=R(!0);function Fe(i,n){const l=d.value.findIndex(h=>h.path===i&&(Array.isArray(h.id)?h.id.includes(n):h.id===n)),c=d.value[l];if(!(l===-1||!c)){if(Z(()=>{me(i,{mode:"silent",warn:!1})}),c.multiple&&c.fieldsCount&&c.fieldsCount--,Array.isArray(c.id)){const h=c.id.indexOf(n);h>=0&&c.id.splice(h,1),delete c.__flags.pendingUnmount[n]}(!c.multiple||c.fieldsCount<=0)&&(d.value.splice(l,1),gt(i),I(),delete S.value[i])}}function Kt(i){G(S.value).forEach(n=>{n.startsWith(i)&&delete S.value[n]}),d.value=d.value.filter(n=>!n.path.startsWith(i)),Z(()=>{I()})}const ne={formId:r,values:u,controlledValues:w,errorBag:ie,errors:de,schema:O,submitCount:f,meta:_,isSubmitting:o,isValidating:a,fieldArrays:g,keepValuesOnUnmount:be,validateSchema:te(O)?$e:void 0,validate:_e,setFieldError:F,validateField:me,setFieldValue:oe,setValues:Qe,setErrors:K,setFieldTouched:ze,setTouched:Ze,resetForm:xe,resetField:ht,handleSubmit:J,useFieldModel:Zt,defineInputBinds:xt,defineComponentBinds:er,defineField:tt,stageInitialValue:Qt,unsetInitialValue:gt,setFieldInitialValue:et,createPathState:k,getPathState:U,unsetPathValue:Ye,removePathState:Fe,initialValues:p,getAllPathStates:()=>d.value,destroyPath:Kt,isFieldTouched:Ht,isFieldDirty:Xt,isFieldValid:Yt};function oe(i,n,l=!0){const c=E(n),h=typeof i=="string"?i:i.path;U(h)||k(h),B(u,h,c),l&&me(h)}function Gt(i,n=!0){G(u).forEach(l=>{delete u[l]}),G(i).forEach(l=>{oe(l,i[l],!1)}),n&&_e()}function Qe(i,n=!0){Re(u,i),g.forEach(l=>l&&l.reset()),n&&_e()}function Je(i,n){const l=U(j(i))||k(i);return z({get(){return l.value},set(c){var h;const v=j(i);oe(v,c,(h=j(n))!==null&&h!==void 0?h:!1)}})}function ze(i,n){const l=U(i);l&&(l.touched=n)}function Ht(i){const n=U(i);return n?n.touched:d.value.filter(l=>l.path.startsWith(i)).some(l=>l.touched)}function Xt(i){const n=U(i);return n?n.dirty:d.value.filter(l=>l.path.startsWith(i)).some(l=>l.dirty)}function Yt(i){const n=U(i);return n?n.valid:d.value.filter(l=>l.path.startsWith(i)).every(l=>l.valid)}function Ze(i){if(typeof i=="boolean"){fe(n=>{n.touched=i});return}G(i).forEach(n=>{ze(n,!!i[n])})}function ht(i,n){var l;const c=n&&"value"in n?n.value:M(p.value,i),h=U(i);h&&(h.__flags.pendingReset=!0),et(i,E(c),!0),oe(i,c,!1),ze(i,(l=n==null?void 0:n.touched)!==null&&l!==void 0?l:!1),F(i,(n==null?void 0:n.errors)||[]),Z(()=>{h&&(h.__flags.pendingReset=!1)})}function xe(i,n){let l=E(i!=null&&i.values?i.values:m.value);l=n!=null&&n.force?l:Re(m.value,l),l=ue(O)&&Q(O.cast)?O.cast(l):l,V(l),fe(c=>{var h;c.__flags.pendingReset=!0,c.validated=!1,c.touched=((h=i==null?void 0:i.touched)===null||h===void 0?void 0:h[c.path])||!1,oe(c.path,M(l,c.path),!1),F(c.path,void 0)}),n!=null&&n.force?Gt(l,!1):Qe(l,!1),K((i==null?void 0:i.errors)||{}),f.value=(i==null?void 0:i.submitCount)||0,Z(()=>{_e({mode:"silent"}),fe(c=>{c.__flags.pendingReset=!1})})}async function _e(i){const n=(i==null?void 0:i.mode)||"force";if(n==="force"&&fe(v=>v.validated=!0),ne.validateSchema)return ne.validateSchema(n);a.value=!0;const l=await Promise.all(d.value.map(v=>v.validate?v.validate(i).then(A=>({key:v.path,valid:A.valid,errors:A.errors})):Promise.resolve({key:v.path,valid:!0,errors:[]})));a.value=!1;const c={},h={};for(const v of l)c[v.key]={valid:v.valid,errors:v.errors},v.errors.length&&(h[v.key]=v.errors[0]);return{valid:l.every(v=>v.valid),results:c,errors:h}}async function me(i,n){var l;const c=U(i);if(c&&(n==null?void 0:n.mode)!=="silent"&&(c.validated=!0),O){const{results:h}=await $e((n==null?void 0:n.mode)||"validated-only");return h[i]||{errors:[],valid:!0}}return c!=null&&c.validate?c.validate(n):(!c&&(l=n==null?void 0:n.warn),Promise.resolve({errors:[],valid:!0}))}function gt(i){It(p.value,i)}function Qt(i,n,l=!1){et(i,n),B(u,i,n),l&&!(e!=null&&e.initialValues)&&B(m.value,i,E(n))}function et(i,n,l=!1){B(p.value,i,E(n)),l&&B(m.value,i,E(n))}async function yt(){const i=te(O);if(!i)return{valid:!0,results:{},errors:{}};a.value=!0;const n=$t(i)||ue(i)?await cn(i,u):await dn(i,u,{names:ge.value,bailsMap:Ce.value});return a.value=!1,n}const Jt=J((i,{evt:n})=>{Kr(n)&&n.target.submit()});cr(()=>{if(e!=null&&e.initialErrors&&K(e.initialErrors),e!=null&&e.initialTouched&&Ze(e.initialTouched),e!=null&&e.validateOnMount){_e();return}ne.validateSchema&&ne.validateSchema("silent")}),Ot(O)&&re(O,()=>{var i;(i=ne.validateSchema)===null||i===void 0||i.call(ne,"validated-only")}),pr(Ut,ne);function tt(i,n){const l=Q(n)||n==null?void 0:n.label,c=U(j(i))||k(i,{label:l}),h=()=>Q(n)?n(qe(c,We)):n||{};function v(){var C;c.touched=!0,((C=h().validateOnBlur)!==null&&C!==void 0?C:ke().validateOnBlur)&&me(c.path)}function A(){var C;((C=h().validateOnInput)!==null&&C!==void 0?C:ke().validateOnInput)&&Z(()=>{me(c.path)})}function N(){var C;((C=h().validateOnChange)!==null&&C!==void 0?C:ke().validateOnChange)&&Z(()=>{me(c.path)})}const T=z(()=>{const C={onChange:N,onInput:A,onBlur:v};return Q(n)?Object.assign(Object.assign({},C),n(qe(c,We)).props||{}):n!=null&&n.props?Object.assign(Object.assign({},C),n.props(qe(c,We))):C});return[Je(i,()=>{var C,$,L;return(L=(C=h().validateOnModelUpdate)!==null&&C!==void 0?C:($=ke())===null||$===void 0?void 0:$.validateOnModelUpdate)!==null&&L!==void 0?L:!0}),T]}function Zt(i){return Array.isArray(i)?i.map(n=>Je(n,!0)):Je(i)}function xt(i,n){const[l,c]=tt(i,n);function h(){c.value.onBlur()}function v(N){const T=Pt(N);oe(j(i),T,!1),c.value.onInput()}function A(N){const T=Pt(N);oe(j(i),T,!1),c.value.onChange()}return z(()=>Object.assign(Object.assign({},c.value),{onBlur:h,onInput:v,onChange:A,value:l.value}))}function er(i,n){const[l,c]=tt(i,n),h=U(j(i));function v(A){l.value=A}return z(()=>{const A=Q(n)?n(qe(h,We)):n||{};return Object.assign({[A.model||"modelValue"]:l.value,[`onUpdate:${A.model||"modelValue"}`]:v},c.value)})}return Object.assign(Object.assign({},ne),{values:kt(u),handleReset:()=>xe(),submitForm:Jt})}function pn(e,t,r,s){const o={touched:"some",pending:"some",valid:"every"},a=z(()=>!ce(t,te(r)));function f(){const u=e.value;return G(o).reduce((d,b)=>{const S=o[b];return d[b]=u[S](I=>I[b]),d},{})}const g=Ge(f());return Mt(()=>{const u=f();g.touched=u.touched,g.valid=u.valid,g.pending=u.pending}),z(()=>Object.assign(Object.assign({initialValues:te(r)},g),{valid:g.valid&&!G(s.value).length,dirty:a.value}))}function mn(e,t,r){const s=Wt(r),o=Y(s),a=Y(E(s));function f(g,u=!1){o.value=Re(E(o.value)||{},E(g)),a.value=Re(E(a.value)||{},E(g)),u&&e.value.forEach(d=>{if(d.touched)return;const S=M(o.value,d.path);B(t,d.path,E(S))})}return{initialValues:o,originalInitialValues:a,setInitialValues:f}}function hn(e,t){return t?{valid:e.valid&&t.valid,errors:[...e.errors,...t.errors]}:e}function Nt(e){const t=Gr(Ut,void 0),r=Y([]),s=()=>{},o={fields:r,remove:s,push:s,swap:s,insert:s,update:s,replace:s,prepend:s,move:s};if(!t||!te(e))return o;const a=t.fieldArrays.find(p=>te(p.path)===te(e));if(a)return a;let f=0;function g(){return M(t==null?void 0:t.values,j(e),[])||[]}function u(){const p=g();Array.isArray(p)&&(r.value=p.map((m,V)=>b(m,V,r.value)),d())}u();function d(){const p=r.value.length;for(let m=0;m<p;m++){const V=r.value[m];V.isFirst=m===0,V.isLast=m===p-1}}function b(p,m,V){if(V&&!Ee(m)&&V[m])return V[m];const _=f++;return{key:_,value:Xr({get(){const O=M(t==null?void 0:t.values,j(e),[])||[],k=r.value.findIndex(H=>H.key===_);return k===-1?p:O[k]},set(O){const k=r.value.findIndex(H=>H.key===_);k!==-1&&ge(k,O)}}),isFirst:!1,isLast:!1}}function S(){d(),t==null||t.validate({mode:"silent"})}function I(p){const m=j(e),V=M(t==null?void 0:t.values,m);if(!V||!Array.isArray(V))return;const _=[...V];_.splice(p,1);const w=m+`[${p}]`;t.destroyPath(w),t.unsetInitialValue(w),B(t.values,m,_),r.value.splice(p,1),S()}function F(p){const m=E(p),V=j(e),_=M(t==null?void 0:t.values,V),w=Ee(_)?[]:_;if(!Array.isArray(w))return;const O=[...w];O.push(m),t.stageInitialValue(V+`[${O.length-1}]`,m),B(t.values,V,O),r.value.push(b(m)),S()}function K(p,m){const V=j(e),_=M(t==null?void 0:t.values,V);if(!Array.isArray(_)||!(p in _)||!(m in _))return;const w=[..._],O=[...r.value],k=w[p];w[p]=w[m],w[m]=k;const H=O[p];O[p]=O[m],O[m]=H,B(t.values,V,w),r.value=O,d()}function ie(p,m){const V=E(m),_=j(e),w=M(t==null?void 0:t.values,_);if(!Array.isArray(w)||w.length<p)return;const O=[...w],k=[...r.value];O.splice(p,0,V),k.splice(p,0,b(V)),B(t.values,_,O),r.value=k,S()}function de(p){const m=j(e);t.stageInitialValue(m,p),B(t.values,m,p),u(),S()}function ge(p,m){const V=j(e),_=M(t==null?void 0:t.values,V);!Array.isArray(_)||_.length-1<p||(B(t.values,`${V}[${p}]`,m),t==null||t.validate({mode:"validated-only"}))}function Ce(p){const m=E(p),V=j(e),_=M(t==null?void 0:t.values,V),w=Ee(_)?[]:_;if(!Array.isArray(w))return;const O=[m,...w];B(t.values,V,O),t.stageInitialValue(V+"[0]",m),r.value.unshift(b(m)),S()}function ye(p,m){const V=j(e),_=M(t==null?void 0:t.values,V),w=Ee(_)?[]:[..._];if(!Array.isArray(_)||!(p in _)||!(m in _))return;const O=[...r.value],k=O[p];O.splice(p,1),O.splice(m,0,k);const H=w[p];w.splice(p,1),w.splice(m,0,H),B(t.values,V,w),r.value=O,S()}const be={fields:r,remove:I,push:F,swap:K,insert:ie,update:ge,replace:de,prepend:Ce,move:ye};return t.fieldArrays.push(Object.assign({path:e,reset:u},be)),dr(()=>{const p=t.fieldArrays.findIndex(m=>j(m.path)===j(e));p>=0&&t.fieldArrays.splice(p,1)}),re(g,p=>{const m=r.value.map(V=>V.value);ce(p,m)||u()}),be}const gn=["type","value"],yn={key:0,class:"text-red-400"},bn=dt({__name:"CustomInput",props:{modelValue:{},error:{},type:{default:"text"}},emits:["update:modelValue","blur"],setup(e){return(t,r)=>(ee(),x("div",null,[y("input",{type:t.type,value:t.modelValue,onInput:r[0]||(r[0]=s=>{var o;return t.$emit("update:modelValue",((o=s.target)==null?void 0:o.value)??"")}),onBlur:r[1]||(r[1]=s=>t.$emit("blur")),class:ft(["form-control",{"border-red-500":t.error}])},null,42,gn),t.error?(ee(),x("span",yn,Me(t.error),1)):hr("",!0)]))}}),Vn=vt(bn,[["__scopeId","data-v-9fd06dc0"]]),On=["type","value"],_n=dt({__name:"CustomTextArea",props:{modelValue:{},error:{},type:{default:"text"}},emits:["update:modelValue","blur"],setup(e){return(t,r)=>(ee(),x("div",null,[y("textarea",{type:t.type,value:t.modelValue,onInput:r[0]||(r[0]=s=>{var o;return t.$emit("update:modelValue",((o=s.target)==null?void 0:o.value)??"")}),onBlur:r[1]||(r[1]=s=>t.$emit("blur")),class:ft(["form-control",{"border-red-500":t.error}])},null,42,On),ut(y("span",{class:"text-red-400"},Me(t.error),513),[[Rt,t.error]])]))}}),Sn=vt(_n,[["__scopeId","data-v-d8fc4721"]]),An=yr({title:Be().required("Este campo es super importante").min(3,"Mínimo de 3 letras!!!"),slug:Be().required(),description:Be().required(),price:_t().required(),stock:_t().required().min(1),gender:Be().required().oneOf(["men","women","kid"])}),wn=dt({components:{CustomInput:Vn,CustomTextArea:Sn},props:{productId:{type:String,required:!0}},setup(e){const t=br(),r=gr(),{data:s,isError:o,isLoading:a,refetch:f}=Er({queryKey:["product",e.productId],queryFn:()=>Cr(e.productId),retry:!1}),{mutate:g,isPending:u,isSuccess:d,data:b}=jr({mutationFn:Pr}),{values:S,defineField:I,errors:F,handleSubmit:K,resetForm:ie,meta:de}=vn({validationSchema:An}),[ge,Ce]=I("title"),[ye,be]=I("slug"),[p,m]=I("description"),[V,_]=I("price"),[w,O]=I("stock"),[k,H]=I("gender"),{fields:Pe,remove:$e,push:fe}=Nt("sizes"),{fields:U}=Nt("images"),Ve=Y([]),ve=K(async R=>{const pe={...R,images:[...R.images,...Ve.value]};g(pe)}),Oe=R=>{const pe=Pe.value.map(Fe=>Fe.value);pe.includes(R)?$e(pe.indexOf(R)):fe(R)},Ye=R=>{const J=R.target.files;if(J&&J.length!==0)for(const Fe of J)Ve.value.push(Fe)};return Mt(()=>{if(o.value&&!a.value){t.replace("/admin/products");return}}),re(s,()=>{s&&ie({values:s.value})},{deep:!0,immediate:!0}),re(d,R=>{R&&(r.success("Producto actualizado correctamente"),t.replace(`/admin/products/${b.value.id}`),ie({values:b.value}),Ve.value=[])}),re(()=>e.productId,()=>{f()}),{values:S,errors:F,meta:de,title:ge,titleAttrs:Ce,slug:ye,slugAttrs:be,description:p,descriptionAttrs:m,price:V,priceAttrs:_,stock:w,stockAttrs:O,gender:k,genderAttrs:H,sizes:Pe,images:U,imageFiles:Ve,onFileChanged:Ye,isPending:u,allSizes:["XS","S","M","L","XL","XXL"],onSubmit:ve,toggleSize:Oe,hasSize:R=>Pe.value.map(J=>J.value).includes(R),temporalImageUrl:R=>URL.createObjectURL(R)}}}),W=e=>(_r("data-v-0fa52cf4"),e=e(),Sr(),e),En={class:"bg-white px-5 py-2 rounded"},In={class:"text-3xl"},jn={class:"text-blue-500"},Cn=W(()=>y("hr",{class:"my-4"},null,-1)),Pn={class:"first-col"},Fn={class:"mb-4"},Nn=W(()=>y("label",{for:"title",class:"form-label"},"Título",-1)),Tn={class:"mb-4"},kn=W(()=>y("label",{for:"slug",class:"form-label"},"Slug",-1)),Mn={class:"mb-4"},Rn=W(()=>y("label",{for:"description",class:"form-label"},"Descripción",-1)),Un={class:"flex flex-row gap-3"},$n={class:"mb-4 flex-1"},zn=W(()=>y("label",{for:"price",class:"form-label"},"Precio",-1)),Bn={class:"mb-4 flex-1"},Dn=W(()=>y("label",{for:"stock",class:"form-label"},"Inventario",-1)),Ln={class:"mb-4"},qn=W(()=>y("label",{for:"sizes",class:"form-label"},"Tallas",-1)),Wn={class:"flex"},Kn=["onClick"],Gn={class:"first-col"},Hn=W(()=>y("label",{for:"stock",class:"form-label"},"Imágenes",-1)),Xn={class:"flex p-2 overflow-x-auto space-x-8 w-full h-[265px] bg-gray-200 rounded"},Yn=["src","alt"],Qn=["src"],Jn={class:"col-span-2 my-2"},Zn=W(()=>y("label",{for:"image",class:"form-label"},"Subir imagen",-1)),xn={class:"mb-4"},es=W(()=>y("label",{for:"stock",class:"form-label"},"Género",-1)),ts=W(()=>y("option",{value:""},"Seleccione",-1)),rs=W(()=>y("option",{value:"kid"},"Niño",-1)),ns=W(()=>y("option",{value:"women"},"Mujer",-1)),ss=W(()=>y("option",{value:"men"},"Hombre",-1)),is=[ts,rs,ns,ss],os={class:"my-4 text-right"},as=["disabled"];function ls(e,t,r,s,o,a){const f=St("CustomInput"),g=St("CustomTextArea");return ee(),x(De,null,[y("div",En,[y("h1",In,[Vr(" Producto: "),y("small",jn,Me(e.title),1)]),Cn]),y("form",{onSubmit:t[7]||(t[7]=(...u)=>e.onSubmit&&e.onSubmit(...u)),class:"grid grid-cols-1 sm:grid-cols-2 bg-white px-5 gap-5"},[y("div",Pn,[y("div",Fn,[Nn,Te(f,we({modelValue:e.title,"onUpdate:modelValue":t[0]||(t[0]=u=>e.title=u)},e.titleAttrs,{error:e.errors.title}),null,16,["modelValue","error"])]),y("div",Tn,[kn,Te(f,we({modelValue:e.slug,"onUpdate:modelValue":t[1]||(t[1]=u=>e.slug=u)},e.slugAttrs,{error:e.errors.slug}),null,16,["modelValue","error"])]),y("div",Mn,[Rn,Te(g,we({modelValue:e.description,"onUpdate:modelValue":t[2]||(t[2]=u=>e.description=u)},e.descriptionAttrs,{error:e.errors.description}),null,16,["modelValue","error"])]),y("div",Un,[y("div",$n,[zn,Te(f,we({modelValue:e.price,"onUpdate:modelValue":t[3]||(t[3]=u=>e.price=u),modelModifiers:{number:!0}},e.priceAttrs,{error:e.errors.price}),null,16,["modelValue","error"])]),y("div",Bn,[Dn,Te(f,we({modelValue:e.stock,"onUpdate:modelValue":t[4]||(t[4]=u=>e.stock=u),modelModifiers:{number:!0}},e.stockAttrs,{error:e.errors.stock}),null,16,["modelValue","error"])])]),y("div",Ln,[qn,y("div",Wn,[(ee(!0),x(De,null,ot(e.allSizes,u=>(ee(),x("button",{key:u,onClick:d=>e.toggleSize(u),type:"button",class:ft(["p-2 rounded w-14 mr-2 flex-1",{"bg-blue-500 text-white":e.hasSize(u),"bg-blue-100":!e.hasSize(u)}])},Me(u),11,Kn))),128))])])]),y("div",Gn,[Hn,y("div",Xn,[(ee(!0),x(De,null,ot(e.images,u=>(ee(),x("div",{key:u.value,class:"flex-shrink-0"},[y("img",{src:u.value,alt:e.title,class:"w-[250px] h-[250px] rounded"},null,8,Yn)]))),128)),(ee(!0),x(De,null,ot(e.imageFiles,u=>(ee(),x("div",{key:u.name,class:"flex-shrink-0"},[y("img",{src:e.temporalImageUrl(u),class:"w-[250px] h-[250px] rounded"},null,8,Qn)]))),128))]),y("div",Jn,[Zn,y("input",{multiple:"",type:"file",id:"image",class:"form-control",accept:"image/*",onChange:t[5]||(t[5]=(...u)=>e.onFileChanged&&e.onFileChanged(...u))},null,32)]),y("div",xn,[es,ut(y("select",we({"onUpdate:modelValue":t[6]||(t[6]=u=>e.gender=u)},e.genderAttrs,{class:"form-control"}),is,16),[[Or,e.gender]]),ut(y("span",{class:"text-red-400"},Me(e.errors.gender),513),[[Rt,e.errors.gender]])]),y("div",os,[y("button",{disabled:e.isPending,type:"submit",class:"disabled:bg-gray-300 bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded"}," Guardar ",8,as)])])],32)],64)}const fs=vt(wn,[["render",ls],["__scopeId","data-v-0fa52cf4"]]);export{fs as default};
